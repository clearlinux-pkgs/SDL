Patch by Petr Pisar
https://bugzilla.libsdl.org/show_bug.cgi?id=4500

@@ -, +, @@ 
 of colors
---
 src/video/SDL_bmp.c | 4 ++++
 1 file changed, 4 insertions(+)
--- a/src/video/SDL_bmp.c	
+++ a/src/video/SDL_bmp.c	
@@ -233,6 +233,10 @@ SDL_Surface * SDL_LoadBMP_RW (SDL_RWops *src, int freesrc)
 	if ( palette ) {
 		if ( biClrUsed == 0 ) {
 			biClrUsed = 1 << biBitCount;
+		} else if ( biClrUsed > (1 << biBitCount) ) {
+			SDL_SetError("BMP file has an invalid number of colors");
+			was_error = SDL_TRUE;
+			goto done;
 		}
 		if ( biSize == 12 ) {
 			for ( i = 0; i < (int)biClrUsed; ++i ) {
-- 

